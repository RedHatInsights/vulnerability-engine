[![Build Status](https://travis-ci.org/RedHatInsights/vulnerability-engine.svg?branch=master)](https://travis-ci.org/RedHatInsights/vulnerability-engine)
[![codecov](https://codecov.io/gh/RedHatInsights/vulnerability-engine/branch/master/graph/badge.svg)](https://codecov.io/gh/RedHatInsights/vulnerability-engine)

# vulnerability-engine

Vulnerability Engine

## Requirements

- VMaaS (Vulnerability Metadata as a Service)
  - Provides core functionality for evaluating vulnerabilities
  - https://github.com/RedHatInsights/vmaas

- Insights Platform
  - Upload service, Inventory, Kafka message queue
  - Mocked Platform service is part of this repository (for development purposes)

## Local testing

### Run VMaaS in docker-compose, populate with repositories and CVEs

### Build images and start containers

    docker-compose up --build

### Upload Insights archives
- Generate testing Insights archive

      echo '{"package_list": ["kernel-3.10.0-862.el7.x86_64"], "repository_list": ["rhel-7-server-rpms"]}' | ./scripts/generate_insights_archive.py -o /tmp/insights-archive.tar.gz -

- Upload Insights archive to Platform mock

      ./scripts/3scale-mock -a 123456 curl -X POST -F "upload=@/tmp/insights-archive.tar.gz" http://localhost:8100/api/v1/upload

- Upload Insights archive to Platform mock and send message to Listener 10 times

      ./scripts/3scale-mock -a 123456 curl -X POST -F "upload=@/tmp/insights-archive.tar.gz" -H "x-upload-multiplier: 10" http://localhost:8100/api/v1/upload

- Delete system

     curl -X DELETE http://localhost:8100/api/v1/delete/be012439-26ae-456c-99a6-27b402331064

### Run tests

You can run all tests from scratch just after cloning repo using command:
```docker-compose -f docker-compose.test.yml up --build --exit-code-from test```
