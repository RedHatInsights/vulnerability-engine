FROM fedora:28
ENV VMAAS_VERSION=latest
ENV APPBASEDIR=/mock

RUN dnf -y update \
        && dnf -y install python3-tornado \
        && rm -rf /var/cache/dnf/*

ADD $APPBASEDIR/entrypoint.sh $APPBASEDIR/
ADD $APPBASEDIR/*.py $APPBASEDIR/
ADD $APPBASEDIR/localhost.* $APPBASEDIR/
ADD $APPBASEDIR/data $APPBASEDIR/data
ADD $APPBASEDIR/data/users $APPBASEDIR/data/users
ADD $APPBASEDIR/data/inventory $APPBASEDIR/data/inventory

RUN adduser --gid 0 -d $APPBASEDIR --no-create-home -c 'Red Hat Insights' insights
USER insights

EXPOSE 8080 8043

CMD ["/mock/entrypoint.sh"]
