FROM python:3.6.8-stretch

RUN apt-get update -y && \
    apt-get install -y postgresql libpq-dev && \
    rm -rf /var/lib/apt/lists/*

ADD . /engine

RUN pip install --upgrade pip && \
    pip install -r /engine/requirements.txt && \
    pip install -r /engine/requirements-evaluator.txt && \
    pip install -r /engine/requirements-listener.txt && \
    pip install -r /engine/requirements-manager.txt && \
    pip install -r /engine/requirements-vmaas-sync.txt

RUN chown -R postgres:postgres /engine

USER postgres
