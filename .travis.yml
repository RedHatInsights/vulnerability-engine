branches:
  only:
    - master
sudo: required
services:
  - docker
language: python
python:
  - "3.6"
notifications:
  email: false
install:
  - pip install -U -r requirements.txt codecov
script:
  - /bin/bash run_tests.sh database -n
  - /bin/bash run_tests.sh evaluator -n
  - /bin/bash run_tests.sh manager -n
  - /bin/bash run_tests.sh listener -n
  - docker-compose up -d ve_database ve_manager || exit 127
  - docker ps
  - source conf/database-connection-admin.env
  - export POSTGRESQL_HOST=localhost
  - export POSTGRESQL_PORT=15432
  - export POSTGRESQL_PASSWORD
  - export POSTGRESQL_USER
  - export POSTGRESQL_DATABASE
  - bash wait-for-services.sh
  - PGPASSWORD=$POSTGRESQL_PASSWORD psql -U $POSTGRESQL_USER -h $POSTGRESQL_HOST -p $POSTGRESQL_PORT -d $POSTGRESQL_DATABASE < database/ve_db_dev_data.sql
  - pytest manager/test/test.py
  - pytest -vvv --cov
  - codecov
