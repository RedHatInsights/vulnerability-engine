"""
Module for /version API endpoint
"""

import os
from peewee import DoesNotExist

from common.logging import get_logger
from common.peewee_model import DbVersion
from .base import GetRequest

LOGGER = get_logger(__name__)
VULNERABILITY_VERSION = os.getenv("APP_VERSION", "unknown")


class GetVersion(GetRequest):
    """GET to /v1/version"""

    _endpoint_name = r'/v1/version'

    @classmethod
    def handle_get(cls, **kwargs):  # pylint: disable=unused-argument
        """Return the data from the db_version table as JSON"""
        try:
            schema_version = DbVersion.get(DbVersion.name == "schema_version").version
        except DoesNotExist:
            schema_version = "unknown"
        return {"application_version": VULNERABILITY_VERSION, "database_version": schema_version}, 200
