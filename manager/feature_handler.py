"""
Module for /feature API endpoint
"""
import connexion

from common.peewee_model import RHAccount
from manager.base import PatchRequest
from manager.rbac_manager import RbacManager as RBAC
from manager.rbac_manager import RbacRoutePermissions


class PatchCvesWithoutErrata(PatchRequest):
    """PATCH to /feature/cves_without_errata"""

    _endpoint_name = r"/v1/feature/cves_without_errata"

    @classmethod
    @RBAC.need_permissions(RbacRoutePermissions.TOGGLE_CVES_WITHOUT_ERRATA)
    def handle_patch(cls, **kwargs):
        """Set cves_without_errata DB flag for account."""
        org_id = connexion.context["user"]["org_id"]
        enable = kwargs["data"]["enable"]
        RHAccount.update(cves_without_errata=enable).where(RHAccount.org_id == org_id).execute()
        return {"updated": {"org_id": org_id, "cves_without_errata": {"enabled": enable}}}
