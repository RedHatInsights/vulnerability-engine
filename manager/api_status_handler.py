"""
Redhat status page API
"""
import signal

from common.config import Config
from .base import GetRequest, ApiStatusTimeoutException

CFG = Config()


class GetApiStatus(GetRequest):
    """Class for handling the Api status requests"""

    _endpoint_name = r"/v1/apistatus"

    @staticmethod
    def _alarm_handler(signal_num, _):
        """Handler for SIGALRM"""
        if signal_num == signal.SIGALRM:
            raise ApiStatusTimeoutException("API timed out")

    @classmethod
    def handle_get(cls, **kwargs):  # pylint: disable=unused-argument
        """Meassure the status of the API, db"""
        signal.signal(signal.SIGALRM, cls._alarm_handler)
        signal.alarm(CFG.timeout_secs)

        # Check if db is alive, API is responding in time
        try:
            # DB is connected through middleware
            return 200
        finally:
            signal.alarm(0)
