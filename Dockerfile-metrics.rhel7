FROM registry.access.redhat.com/rhel7

RUN yum-config-manager --enable rhel-server-rhscl-7-rpms && \
    yum -y install rh-python36 which postgresql && \
    rm -rf /var/cache/yum/*

ENV PATH=/opt/rh/rh-python36/root/usr/bin:$PATH

WORKDIR /metrics

ADD /metrics/Pipfile*    /metrics/

ENV LC_ALL=en_US.utf8
ENV LANG=en_US.utf8
RUN pip install --upgrade pip pipenv && \
    pipenv install --system && pipenv check

RUN adduser --gid 0 -d /metrics --no-create-home insights

USER insights

ADD /metrics/*.txt           /metrics/
ADD /metrics/*.py            /metrics/metrics/

CMD metrics/metrics_gather.py -v
