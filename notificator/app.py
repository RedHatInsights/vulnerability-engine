"""
Notificator api handlers
"""

from aiohttp import web

from .notificator_queue import NotificatorQueue


class CacheHandler(web.View):
    """Cache handler"""

    async def put(self):
        """Refresh notified accs from DB"""
        queue = NotificatorQueue(None, None, None, None)
        await queue.refresh_map()
        return web.Response(status=200)


def create_notificator_app(logger, views):
    """Create instance of notificator app"""
    app = web.Application(logger=logger)
    for url, view in views:
        app.router.add_view(url, view)
    return app


def create_notif_app_runner(app, port, logger, loop):
    """Create AIOHTTP runner"""
    runner = web.AppRunner(app, logger=logger)

    loop.run_until_complete(runner.setup())

    site = web.TCPSite(runner, "0.0.0.0", port)
    return runner, site
