FROM centos:7

RUN yum -y update \
        && yum -y install java-openjdk-headless \
        && rm -rf /var/cache/yum/*

ENV APPBASEDIR=/platform_mock

ADD $APPBASEDIR/entrypoint.sh $APPBASEDIR

RUN cd $APPBASEDIR \
        && curl -O https://www.apache.org/dist/kafka/2.2.0/kafka_2.12-2.2.0.tgz \
        && tar -xz --strip-components=1 -f kafka_*.tgz

RUN adduser --gid 0 -d $APPBASEDIR --no-create-home -c 'Red Hat Insights' insights
USER insights

EXPOSE 9092

CMD ["sh", "-c", "$APPBASEDIR/entrypoint.sh"]
