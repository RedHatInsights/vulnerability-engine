"""
Postgresql settings for peewee mappings.
"""
from playhouse.postgres_ext import PostgresqlExtDatabase

from common.config import Config
from common.logging import get_logger

LOGGER = get_logger(__name__)

CFG = Config()

DB = PostgresqlExtDatabase(
    CFG.db_name,
    user=CFG.db_user,
    password=CFG.db_pass,
    host=CFG.db_host,
    port=CFG.db_port,
    sslmode=CFG.db_ssl_mode,
    sslrootcert=CFG.db_ssl_root_cert_path,
)

DB_READ_REPLICA = None
if CFG.db_read_replica_enabled:
    if not CFG.db_host_read_replica:
        LOGGER.error("db_host_read_replica not set!")
    elif not CFG.db_port_read_replica:
        LOGGER.error("db_port_read_replica not set!")
    else:
        DB_READ_REPLICA = PostgresqlExtDatabase(
            CFG.db_name,
            user=CFG.db_user,
            password=CFG.db_pass,
            host=CFG.db_host_read_replica,
            port=CFG.db_port_read_replica,
            sslmode=CFG.db_ssl_mode,
            sslrootcert=CFG.db_ssl_root_cert_path,
        )
