"""
Database to peewee mappings
"""
from peewee import Model, TextField, DateTimeField, DecimalField, ForeignKeyField, BooleanField
from .peewee_database import DB


class UnknownField:
    """UnknownField"""
    def __init__(self, *_, **__):
        pass


class BaseModel(Model):
    """Base class for tables"""
    class Meta:
        """Base class for table metadata"""
        database = DB


class SystemPlatform(BaseModel):
    """system_platform table"""
    inventory_id = TextField(null=False, unique=True)
    rh_account = TextField(null=False)
    first_reported = DateTimeField(null=False)
    s3_url = TextField(null=True)
    vmaas_json = TextField(null=True)
    json_checksum = TextField(null=True)
    satellite_managed = BooleanField(null=False)
    last_updated = DateTimeField(null=False)
    unchanged_since = DateTimeField(null=False)

    class Meta:
        """system_platform table metadata"""
        table_name = "system_platform"
        primary_key = False


class VulnerabilitySource(BaseModel):
    """vulnerability_source table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """vulnerability_source table metadata"""
        table_name = "vulnerability_source"

class CveImpact(BaseModel):
    """cve_impact table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """cve_impact table metadata"""
        table_name = "cve_impact"

class Status(BaseModel):
    """Available status-values table"""
    name = TextField(null=False, unique=True)
    class Meta:
        """status table metadata"""
        table_name = "status"

class CveMetadata(BaseModel):
    """cve_metadata table"""
    cve = TextField(primary_key=True)
    cvss3_score = DecimalField(index=True, null=True)
    cvss3_metrics = TextField(null=True)
    description = TextField(null=False)
    impact_id = ForeignKeyField(column_name="impact_id", model=CveImpact, field="id")
    public_date = DateTimeField(null=False)
    modified_date = DateTimeField(null=False)
    cvss2_score = DecimalField(index=True, null=True)
    cvss2_metrics = TextField(null=True)

    class Meta:
        """cve_metadata table metadata"""
        table_name = 'cve_metadata'


class SystemVulnerabilities(BaseModel):
    """system_vulnerabilities table"""
    inventory_id = ForeignKeyField(column_name="inventory_id", model=SystemPlatform, field="inventory_id")
    cve = ForeignKeyField(column_name="cve", model=CveMetadata, field="cve")
    vulnerability_source = ForeignKeyField(column_name="vulnerability_source", model=VulnerabilitySource, field="id")
    first_reported = DateTimeField(null=False)
    when_mitigated = DateTimeField(null=True)
    status = ForeignKeyField(column_name="status_id", model=Status, field="id")

    class Meta:
        """system_vulnerabilities table metadata"""
        table_name = "system_vulnerabilities"


class ProdsecRule(BaseModel):
    """prodsec_rule table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """prodsec_rule table metadata"""
        table_name = 'prodsec_rule'


class SysVulnRulesResults(BaseModel):
    """sys_vuln_rules_results table"""
    sys_vuln_id = ForeignKeyField(column_name="sys_vuln_id", model=SystemVulnerabilities, field="id")
    prodsec_rule_id = ForeignKeyField(column_name="prodsec_rule_id", model=ProdsecRule, field="id")
    details = TextField(null=True)

    class Meta:
        """sys_vuln_rules_results table metadata"""
        table_name = 'sys_vuln_rules_results'
        primary_key = False
