"""
Database to peewee mappings
"""
import os

from peewee import PostgresqlDatabase, Model, TextField, DateTimeField, DecimalField, ForeignKeyField, BooleanField

DB_NAME = os.getenv('POSTGRESQL_DATABASE', "vulnerability")
DB_USER = os.getenv('POSTGRESQL_USER', "ve_db_user_unknown")
DB_PASS = os.getenv('POSTGRESQL_PASSWORD', "ve_db_user_unknown_pwd")
DB_HOST = os.getenv('POSTGRESQL_HOST', "ve_database")
DB_PORT = int(os.getenv('POSTGRESQL_PORT', "5432"))

DB = PostgresqlDatabase(DB_NAME, user=DB_USER, password=DB_PASS, host=DB_HOST, port=DB_PORT)


class UnknownField:
    """UnknownField"""
    def __init__(self, *_, **__):
        pass


class BaseModel(Model):
    """Base class for tables"""
    class Meta:
        """Base class for table metadata"""
        database = DB


class SystemPlatform(BaseModel):
    """system_platform table"""
    inventory_id = TextField(null=False, unique=True)
    rh_account = TextField(null=False)
    first_reported = DateTimeField(null=False)
    s3_url = TextField(null=True)
    vmaas_json = TextField(null=True)
    json_checksum = TextField(null=True)
    satellite_managed = BooleanField(null=False)
    last_updated = DateTimeField(null=False)
    unchanged_since = DateTimeField(null=False)
    last_evaluation = DateTimeField(null=True)

    class Meta:
        """system_platform table metadata"""
        db_table = "system_platform"
        primary_key = False


class VulnerabilitySource(BaseModel):
    """vulnerability_source table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """vulnerability_source table metadata"""
        db_table = "vulnerability_source"

class CveImpact(BaseModel):
    """cve_impact table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """cve_impact table metadata"""
        db_table = "cve_impact"

class Status(BaseModel):
    """Available status-values table"""
    name = TextField(null=False, unique=True)
    class Meta:
        """status table metadata"""
        db_table = "status"

class CveMetadata(BaseModel):
    """cve_metadata table"""
    cve = TextField(primary_key=True)
    cvss3_score = DecimalField(index=True, null=True)
    cvss3_metrics = TextField(null=True)
    description = TextField(null=False)
    impact_id = ForeignKeyField(db_column="impact_id", model=CveImpact, to_field="id")
    public_date = DateTimeField(null=False)
    modified_date = DateTimeField(null=False)
    cvss2_score = DecimalField(index=True, null=True)
    cvss2_metrics = TextField(null=True)

    class Meta:
        """cve_metadata table metadata"""
        db_table = 'cve_metadata'


class SystemVulnerabilities(BaseModel):
    """system_vulnerabilities table"""
    inventory_id = ForeignKeyField(db_column="inventory_id", model=SystemPlatform, to_field="inventory_id")
    cve = ForeignKeyField(db_column="cve", model=CveMetadata, to_field="cve")
    vulnerability_source = ForeignKeyField(db_column="vulnerability_source", model=VulnerabilitySource, to_field="id")
    first_reported = DateTimeField(null=False)
    when_mitigated = DateTimeField(null=True)
    status = ForeignKeyField(db_column="status_id", model=Status, to_field="id")

    class Meta:
        """system_vulnerabilities table metadata"""
        db_table = "system_vulnerabilities"


class ProdsecRule(BaseModel):
    """prodsec_rule table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """prodsec_rule table metadata"""
        db_table = 'prodsec_rule'


class SysVulnRulesResults(BaseModel):
    """sys_vuln_rules_results table"""
    sys_vuln_id = ForeignKeyField(db_column="sys_vuln_id", model=SystemVulnerabilities, to_field="id")
    prodsec_rule_id = ForeignKeyField(db_column="prodsec_rule_id", model=ProdsecRule, to_field="id")
    details = TextField(null=True)

    class Meta:
        """sys_vuln_rules_results table metadata"""
        db_table = 'sys_vuln_rules_results'
        primary_key = False
