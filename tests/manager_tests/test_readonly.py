# -*- coding: utf-8 -*-
# pylint: disable=missing-docstring,too-many-public-methods,invalid-name
"""
Manager read only mode tests.
"""
from manager import base
from .vuln_testcase import FlaskTestCase

CSV_EXPORT_ENDPOINTS = ('cves/CVE-2016-1/affected_systems', 'systems',
                        'systems/INV-4/cves', 'vulnerabilities/cves')


class TestManager(FlaskTestCase):

    def test_status(self, monkeypatch):
        monkeypatch.setattr(base, 'READ_ONLY_MODE', 1)
        self.vfetch('status', data='{"inventory_id": "INV-5", "cve":"CVE-2014-1", "status_id":2}',
                    method='PATCH').check_response(status_code=503)

    def test_opt_out(self, monkeypatch):
        monkeypatch.setattr(base, 'READ_ONLY_MODE', 1)
        response = self.vfetch("systems/INV-4/opt_out?value=true", data="", method="PATCH")
        assert response.status_code == 503

    def test_refresh(self, monkeypatch):
        monkeypatch.setattr(base, 'READ_ONLY_MODE', 1)
        response = self.vfetch("refresh/accounts/0", internal_user=True, method="PUT")
        assert response.status_code == 503
