# -*- coding: utf-8 -*-
# pylint:disable=missing-docstring,redefined-outer-name
import pytest

from .utils import get_pg_class, restore_db, set_env


@pytest.fixture(scope="session")
def pg_class():
    """Setup PostgreSQL class."""
    postgres_class = get_pg_class()
    yield postgres_class
    postgres_class.clear_cache()


@pytest.fixture(scope="session")
def pg_db_session(pg_class):
    """Setup PostgreSQL in session scope."""
    postgresql = pg_class()
    set_env(postgresql)
    yield postgresql
    postgresql.stop()


@pytest.fixture(scope="module")
def pg_db_mod(pg_db_session):
    """Restores PostgreSQL in module scope."""
    yield pg_db_session
    restore_db(pg_db_session)


@pytest.fixture(scope="function")
def pg_db_func(pg_db_session):
    """Restores PostgreSQL in function scope."""
    yield pg_db_session
    restore_db(pg_db_session)
