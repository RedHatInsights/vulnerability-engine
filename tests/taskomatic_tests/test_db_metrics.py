"""
Unit tests for db_metrics taskomatic job
"""

from common.database_handler import DatabasePoolConnection
import taskomatic.jobs.db_metrics as dm


class TestDbMetrics():
    """
    Class holding all tests
    """

    @staticmethod
    def test_db_metrics(pg_db_conn, monkeypatch):  # pylint: disable=unused-argument)
        """Test gathering of DB"""

        with DatabasePoolConnection() as conn:
            monkeypatch.setattr(dm, 'get_conn', lambda: conn)
            dm.run()

        assert dm.METRIC_SYSTEMS.collect()[0].samples[0].value == 20  # there are 20 systems in DB
        assert dm.METRIC_CYNDI_SYSTEMS.collect()[0].samples[0].value == 19  # there are also 19 systems syndicated
        assert len(dm.METRIC_TABLE_SIZE.collect()[0].samples) == 276
