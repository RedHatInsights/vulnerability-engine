
# -*- coding: utf-8 -*-
# pylint: disable=no-self-use
"""
Test creating pages.
"""
import os
import logging

from common.paging import paging

DEFAULT_PAGE = 2
DEFAULT_PAGE_SIZE = 2

VMAAS_HOST = os.getenv('VMAAS_HOST', 'http://vmaas_webapp:8000')
VMAAS_REPOS_ENDPOINT = "%s/api/v1/repos" % VMAAS_HOST
VMAAS_CVES_ENDPOINT = "%s/api/v1/cves" % VMAAS_HOST


class TestPaging:
    "TestPaging"

    def test_repos_paging(self, caplog):  # pylint: disable=unused-argument
        """Test downloading all repos pages"""
        repos_json = {"repository_list": [".*"], "page": DEFAULT_PAGE, "page_size": DEFAULT_PAGE_SIZE}
        with caplog.at_level(logging.INFO):
            success, repos_pages = paging(VMAAS_REPOS_ENDPOINT, repos_json)
            assert success
            assert repos_pages['page'] == 2
        caplog.clear()

    def test_cves_paging(self, caplog):  # pylint: disable=unused-argument
        """Test downloading all cves pages"""
        cves_json = {"cve_list": [".*"], "page": DEFAULT_PAGE, "page_size": DEFAULT_PAGE_SIZE, "rh_only": True}
        with caplog.at_level(logging.INFO):
            success, cves_pages = paging(VMAAS_CVES_ENDPOINT, cves_json)
            assert success
            assert cves_pages['page'] == 12
        caplog.clear()
