FROM fedora:28

RUN dnf -y update \
        && dnf -y install java-openjdk-headless \
        && rm -rf /var/cache/dnf/*

ENV APPBASEDIR=/kafka

ADD $APPBASEDIR/entrypoint.sh /kafka/

RUN cd /kafka \
        && curl -O https://www.apache.org/dist/kafka/2.0.0/kafka_2.12-2.0.0.tgz \
        && tar -xz --strip-components=1 -f kafka_*.tgz

RUN adduser --gid 0 -d /kafka --no-create-home -c 'Red Hat Insights' insights
USER insights

EXPOSE 9092

CMD ["sh", "-c", "$APPBASEDIR/entrypoint.sh"]
