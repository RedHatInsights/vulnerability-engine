version: '3'

services:
  mock:
    container_name: vulnerability-engine-mock
    build: ./mock
    image: vulnerability-engine/mock:latest
    restart: unless-stopped
    ports:
      - 8080:8080
      - 8043:8043

  database:
    container_name: vulnerability-engine-database
    build: ./database
    image: vulnerability-engine/database:latest
    restart: unless-stopped
    env_file:
          - ./conf/database-connection.env
          - ./conf/database-user-admin.env
          - ./conf/database-user-reader.env
          - ./conf/database-user-writer.env
    ports:
          - 15432:5432
    volumes:
          - vulnerability-engine-db-data:/var/lib/pgsql/data

  evaluator:
    container_name: vulnerability-engine-evaluator
    build: ./evaluator
    image: vulnerability-engine/evaluator:latest
    restart: unless-stopped
    ports:
      - 8100:8000

  listener:
    container_name: vulnerability-engine-listener
    build: ./listener
    image: vulnerability-engine/listener:latest
    restart: unless-stopped
    ports:
      - 8200:8000
    depends_on:
      - database

  manager:
    container_name: vulnerability-engine-manager
    build: ./manager
    image: vulnerability-engine/manager:latest
    restart: unless-stopped
    ports:
      - 8300:8000

  kafka:
    container_name: vulnerability-kafka
    build: ./kafka
    image: vulnerability-engine/kafka:latest
    restart: unless-stopped
    ports:
      - 9092:9092

volumes:
  vulnerability-engine-db-data:
