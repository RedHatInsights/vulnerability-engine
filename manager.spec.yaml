openapi: "3.0.0"

info:
  title: Vulnerability Engine Manager

paths:
  /v1/version:
    get:
      summary: Application version
      description: Get application version.
      operationId: manager.version_handler.GetVersion.get
      x-methodName: getVersion
      responses:
        200:
          description: Application version.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/VersionOut'

  /v1/business_risk:
    get:
      summary: Available business risk/business_risk_id pairs.
      description: Returns available business risk and business_risk_id pairs where business_risk_id is internal ID of the business risk.
      operationId: manager.risk_handler.GetRisk.get
      x-methodName: getBusinessRiskList
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: List of business risk/business_risk_id pairs.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/BusinessRiskListOut'


  /v1/cves/{cve_id}:
    get:
      summary: Details of a CVE.
      description: Show all information about given CVE.
      operationId: manager.cve_handler.GetCves.get
      x-methodName: getCveDetails
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: CVE details
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/CveDetailOut'
        404:
          description: Given CVE does not exist.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters:
        - $ref: '#/components/parameters/cve_id'

  /v1/cves/{cve_id}/affected_systems:
    get:
      summary: Affected systems for a given CVE.
      description: Report of affected systems for a given CVE.
      operationId: manager.cve_handler.GetCvesAffectedSystems.get
      x-methodName: getAffectedSystemsByCve
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: Report of affected systems for a given CVE.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/AffectedSystemsOut'
        404:
          description: Given CVE does not exist.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/limit'
        - $ref: '#/components/parameters/offset'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/page_size'
        - $ref: '#/components/parameters/sort'
        - $ref: '#/components/parameters/cve_id'
        - $ref: '#/components/parameters/status_id'
        - $ref: '#/components/parameters/data_format'
        - $ref: '#/components/parameters/security_rule'
        - in: query
          name: rule_name
          description: Filter by the name of security rule.
          schema:
            type: string
          example: CVE_2018_3639_cpu_kernel

  /v1/cves/business_risk:
    patch:
      summary: Set business risk for a CVE.
      description: Sets business risk for a CVE.
      operationId: manager.cve_handler.PatchCveRisk.patch
      x-methodName: setCveBusinessRisk
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      requestBody:
        description: Values to be set. At least one of the "business_risk_id" or "business_risk_text" parameters is required.
        required: true
        content:
          application/vnd.api+json:
            schema:
              $ref: '#/components/schemas/CveRiskIn'
              x-body-name: data
      responses:
        200:
          description: Business risk successfully updated.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/BulkChangeOut'
        404:
          description: Given CVE does not exist.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'

  /v1/cves/status:
    patch:
      summary: Set status for a CVE.
      description: Sets status for a CVE.
      operationId: manager.cve_handler.PatchCveStatus.patch
      x-methodName: setCveStatus
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      requestBody:
        description: Values to be set. At least one of the "status_id" or "status_text" parameters is required.
        required: true
        content:
          application/vnd.api+json:
            schema:
              $ref: '#/components/schemas/CveStatusIn'
              x-body-name: data
      responses:
        200:
          description: Status successfully updated.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/BulkChangeOut'
        404:
          description: Given CVE does not exist.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'

  /v1/report/executive:
    get:
      summary: Top level overview of vulnerabilities.
      description: Returns top level overview of vulnerabilities affecting given account.
      operationId: manager.report_handler.GetExecutive.get
      x-methodName: getExecutiveReport
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: Executive report.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/ExecutiveReport'

  /v1/status:
    get:
      summary: Available status/status_id pairs.
      description: Returns available status and status_id pairs where status_id is internal ID of the status.
      operationId: manager.status_handler.GetStatus.get
      x-methodName: getStatusList
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: List of status/status_id pairs.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/StatusListOut'
    patch:
      summary: Set status for system vulnerabilities.
      description: Sets status for given hosts and CVEs.
      operationId: manager.status_handler.PatchStatus.patch
      x-methodName: setStatus
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      requestBody:
        description: Values to be set.
        required: true
        content:
          application/vnd.api+json:
            schema:
              $ref: '#/components/schemas/StatusIn'
              x-body-name: data
      responses:
        200:
          description: Status successfully updated.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/StatusOut'
        404:
          description: Given host/CVE does not exist.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'

  /v1/systems:
    get:
      summary: List systems.
      description: List systems visible to logged in account with basic information related to vulnerabilities.
      operationId: manager.system_handler.GetSystems.get
      x-methodName: getSystemsList
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: System list
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/SystemListOut'
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/limit'
        - $ref: '#/components/parameters/offset'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/page_size'
        - $ref: '#/components/parameters/sort'
        - $ref: '#/components/parameters/data_format'
        - $ref: '#/components/parameters/stale'
        - in: query
          name: opt_out
          description: If set to true, shows systems which have been opted out from vulnerability application. If not set defaults to false.
          schema:
            type: boolean
          example: true

  /v1/systems/{inventory_id}:
    get:
      summary: System details.
      description: Provides details of a system, e.g. it's opt out status.
      operationId: manager.system_handler.GetSystemDetails.get
      x-methodName: getSystemDetails
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: System details
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/SystemDetailsOut'
        404:
          description: System has not been found in the database.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters:
        - $ref: '#/components/parameters/inventory_id'
        - $ref: '#/components/parameters/stale'
    delete:
      summary: Delete system.
      description: Deletes system from database.
      operationId: manager.system_handler.DeleteSystem.delete
      x-methodName: deleteSystem
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: System has been deleted.
        404:
          description: System has not been found in the database.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters:
        - $ref: '#/components/parameters/inventory_id'

  /v1/systems/{inventory_id}/cves:
    get:
      summary: CVE report for a system.
      description: Shows detailed information about all CVEs the system is exposed to.
      operationId: manager.system_handler.GetSystemsCves.get
      x-methodName: getCveListBySystem
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: CVE report.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/SystemCvesOut'
        404:
          description: System has not been found in the database.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters:
        - $ref: '#/components/parameters/inventory_id'
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/limit'
        - $ref: '#/components/parameters/offset'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/page_size'
        - $ref: '#/components/parameters/sort'
        - $ref: '#/components/parameters/cvss_from'
        - $ref: '#/components/parameters/cvss_to'
        - $ref: '#/components/parameters/public_from'
        - $ref: '#/components/parameters/public_to'
        - $ref: '#/components/parameters/impact'
        - $ref: '#/components/parameters/status_id'
        - $ref: '#/components/parameters/data_format'
        - $ref: '#/components/parameters/business_risk_id'
        - $ref: '#/components/parameters/stale'
        - $ref: '#/components/parameters/security_rule'

  /v1/systems/{inventory_id}/opt_out:
    patch:
      summary: Opt in/out a system to/from vulnerability application.
      description: Opts in/out a systems. Opted out system is not shown and manageable by the vulnerability application.
      operationId: manager.system_handler.PatchSystemsOptOut.patch
      x-methodName: setSystemOptOut
      deprecated: true
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: System setting has been updated.
        404:
          description: System has not been found in the database.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters: 
        - $ref: '#/components/parameters/inventory_id'
        - in: query
          name: value
          description: opt_out setting of the host.
          required: true
          schema:
            type: boolean
            example: true

  /v1/systems/opt_out:
    patch:
      summary: Opt in/out a system to/from vulnerability application.
      description: Opts in/out a systems. Opted out system is not shown and manageable by the vulnerability application.
      operationId: manager.system_handler.PatchBulkSystemsOptOut.patch
      x-methodName: setSystemsOptOut
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      requestBody:
        description: Values to be set.
        required: true
        content:
          application/vnd.api+json:
            schema:
              $ref: '#/components/schemas/OptOutIn'
              x-body-name: data
      responses:
        200:
          description: System(s) setting has been updated.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/BulkChangeOut'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'

  /v1/vulnerabilities/cves:
    get:
      summary: Vulnerabilities overview.
      description: Overview of vulnerabilities across whole host inventory.
      operationId: manager.vulnerabilities_handler.GetCves.get
      x-methodName: getCveList
      security:
        - ApiKeyAuth: []
        - BasicAuth: []
      responses:
        200:
          description: Vulnerabilities overview.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/VulnerabilitiesOut'
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/limit'
        - $ref: '#/components/parameters/offset'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/page_size'
        - $ref: '#/components/parameters/sort'
        - $ref: '#/components/parameters/cvss_from'
        - $ref: '#/components/parameters/cvss_to'
        - $ref: '#/components/parameters/public_from'
        - $ref: '#/components/parameters/public_to'
        - $ref: '#/components/parameters/impact'
        - $ref: '#/components/parameters/data_format'
        - $ref: '#/components/parameters/business_risk_id'
        - $ref: '#/components/parameters/status_id'
        - $ref: '#/components/parameters/security_rule'
        - in: query
          name: show_all
          description: Show all known vulnerabilities, regardless of number of affected systems.
          schema:
            type: boolean
          example: true

  /v1/refresh/accounts/{account_id}:
    put:
      summary: Refresh cached counts for given account ID.
      description: Refresh cached counts for given account ID. Admin interface, available only to internal users.
      operationId: manager.refresh_handler.RefreshAccount.put
      x-methodName: refreshAccount
      security:
        - ApiKeyAuthInternal: []
        - BasicAuth: []
      responses:
        200:
          description: Cached counts for given account successfully updated.
        404:
          description: Account was not found.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters: 
        - $ref: '#/components/parameters/account_id'
      tags:
        - internal

  /v1/refresh/accounts/{account_id}/cves/{cve_id}:
    put:
      summary: Refresh cached counts for given account ID and CVE.
      description: Refresh cached counts for given account ID and CVE. Admin interface, available only to internal users.
      operationId: manager.refresh_handler.RefreshAccountCve.put
      x-methodName: refreshAccountCve
      security:
        - ApiKeyAuthInternal: []
        - BasicAuth: []
      responses:
        200:
          description: Cached counts for given account and CVE successfully updated.
        404:
          description: Account or CVE was not found.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters: 
        - $ref: '#/components/parameters/account_id'
        - $ref: '#/components/parameters/cve_id'
      tags:
        - internal

  /v1/refresh/cves/{cve_id}:
    put:
      summary: Refresh cached counts for given CVE.
      description: Refresh cached counts for given CVE. Admin interface, available only to internal users.
      operationId: manager.refresh_handler.RefreshCve.put
      x-methodName: refreshCve
      security:
        - ApiKeyAuthInternal: []
        - BasicAuth: []
      responses:
        200:
          description: Cached counts for given CVE successfully updated.
        404:
          description: CVE was not found.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters: 
        - $ref: '#/components/parameters/cve_id'
      tags:
        - internal

  /v1/refresh/systems/{inventory_id}:
    put:
      summary: Refresh cached counts for given inventory ID.
      description: Refresh cached counts for given inventory ID. Admin interface, available only to internal users.
      operationId: manager.refresh_handler.RefreshSystem.put
      x-methodName: refreshSystem
      security:
        - ApiKeyAuthInternal: []
        - BasicAuth: []
      responses:
        200:
          description: Cached counts for given system successfully updated.
        404:
          description: System was not found.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
        503:
          description: Service is running in read-only mode.
          content:
            application/vnd.api+json:
              schema:
                $ref: '#/components/schemas/Errors'
      parameters: 
        - $ref: '#/components/parameters/inventory_id'
      tags:
        - internal

components:
  parameters:
    filter:
      in: query
      name: filter
      description: Full text filter.
      schema:
        type: string
      example: INV-ID-1234

    limit:
      in: query
      name: limit
      description: Maximum number of records per page. Limit/Offset pagination wins over page/page_size pagination.
      schema:
        type: integer
      example: 25

    offset:
      in: query
      name: offset
      description: Offset of first record of paginated response. Limit/Offset pagination wins over page/page_size pagination.
      schema:
        type: integer
      example: 1

    page:
      in: query
      name: page
      description: Page number of paginated response. Limit/Offset pagination wins over page/page_size pagination.
      schema:
        type: integer
      example: 1
  
    page_size:
      in: query
      name: page_size
      description: Page size of paginated response. Limit/Offset pagination wins over page/page_size pagination.
      schema:
        type: integer
      example: 25

    sort:
      in: query
      name: sort
      description: Sorting used for response.
      schema:
        type: string
      example: -inventory_id

    inventory_id:
      in: path
      name: inventory_id
      description: Inventory ID.
      required: true
      schema:
        type: string
      example: INV-ID-0000-1234

    cve_id:
      in: path
      name: cve_id
      description: CVE id.
      required: true
      schema:
        type: string
      example: CVE-2016-0800

    public_from:
      in: query
      name: public_from
      description: Filter CVEs based on their published date, starting from the date.
      schema:
        type: string
      example: '2017-09-18T00:00:00+00:00'

    public_to:
      in: query
      name: public_to
      description: Filter CVEs based on their published date, up to the date.
      schema:
        type: string
      example: '2017-09-18T00:00:00+00:00'

    cvss_from:
      in: query
      name: cvss_from
      description: Filter based on cvss score, starting from the value.
      schema:
        type: number
      example: 4.6

    cvss_to:
      in: query
      name: cvss_to
      description: Filter based on cvss score, up to the value.
      schema:
        type: number
      example: 7.2

    impact:
      in: query
      name: impact
      description: Filter based on impact IDs.
      schema:
        type: string
      example: '5,7'

    status_id:
      in: query
      name: status_id
      description: Filer based on CVE status ID.
      schema:
        type: string
        example: '1,4'

    business_risk_id:
      in: query
      name: business_risk_id
      description: Filter based on business risk IDs.
      schema:
        type: string
        example: 1,3

    data_format:
      in: query
      name: data_format
      description: Format of the output data, either JSON (default) or CSV.
      schema:
        type: string
        example: json

    account_id:
      in: path
      name: account_id
      description: Account ID of user.
      required: true
      schema:
        type: string
      example: '123456'

    stale:
      in: query
      name: stale
      description: If set to true, shows stale systems. If not set defaults to false.
      schema:
        type: boolean

    security_rule:
      in: query
      name: security_rule
      description: If true shows only CVEs with security rule associated, if false shows CVEs without rules. When not set shows all CVEs.
      schema:
        type: boolean
      example: true

  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
      description: Username and password login.
      x-basicInfoFunc: manager.base.basic_auth

    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-rh-identity
      description: Identity header provided by 3scale (for non-prod testing only).
      x-apikeyInfoFunc: manager.base.auth
    
    ApiKeyAuthInternal:
      type: apiKey
      in: header
      name: x-rh-identity
      description: Identity header provided by 3scale (for non-prod testing only).
      x-apikeyInfoFunc: manager.base.auth_internal

  schemas:
    Errors:
      type: object
      properties:
        errors:
          type: array
          items:
            type: object
            properties:
              detail:
                type: string
                description: Error detail.
                example: Record not found.
              status:
                type: string
                description: String representation of HTTP status code.
                example: 404
            required:
              - detail
              - status
          minItems: 1
      required:
        - errors

    Links:
      type: object
      properties:
        first:
          type: string
          description: Link to first page.
          example: /api?offset=0&limit=1
        last:
          type: string
          description: Link to last page.
          example: /api?offset=7&limit=1
        next:
          type: string
          description: Link to next page.
          example: /api?offset=5&limit=1
          nullable: true
        previous:
          type: string
          description: Link to next page.
          example: /api?offset=3&limit=1
          nullable: true
      required:
        - first
        - last
        - next
        - previous

    Meta:
      type: object
      properties:
        filter:
          type: string
          description: Full text filter
          example: CVE-2016-0800
          nullable: true
        limit:
          type: integer
          description: Maximum number of paginated results.
          example: 25
        offset:
          type: integer
          description: First record of paginated response.
          example: 0
        page:
          type: integer
          description: Page number of paginated response.
          example: 1
        page_size:
          type: integer
          description: Number of records per page of paginated response.
          example: 25
        pages:
          type: integer
          description: Total number of pages of paginated response.
          example: 1
        sort:
          type: string
          description: Sorting filter.
          example: -inventory_id
          nullable: true
        total_items:
          type: integer
          description: Total number of records.
          example: 37
        data_format:
          type: string
          description: Format of the output data, either JSON (default) or CSV.
          example: JSON
      required:
        - filter
        - limit
        - offset
        - page
        - page_size
        - pages
        - sort
        - total_items
        - data_format

    MetaVulnerabilitiesOut:
      allOf:
        - $ref: '#/components/schemas/Meta'
        - type: object
          properties:
            business_risk_id:
              type: string
              description: Filter based on business risk IDs.
              example: 1,3
              nullable: true
            cvss_from:
              type: number
              description: Filter based on cvss score, starting from the value.
              example: 4.6
              nullable: true
            cvss_to:
              type: number
              description: Filter based on cvss score, up to the value.
              example: 7.2
              nullable: true
            show_all:
              type: boolean
              description: Show all known vulnerabilities, regardless of number of affected systems.
              example: true
              nullable: true
            public_from:
              type: string
              description: Filter CVEs based on their published date, starting from the date.
              example: '2017-09-18T00:00:00+00:00'
              nullable: true
            public_to:
              type: string
              description: Filter CVEs based on their published date, up to the date.
              example: '2017-09-18T00:00:00+00:00'
              nullable: true
            impact:
              type: string
              description: Filter based on impact IDs.
              example: '5,7'
              nullable: true
          required:
            - business_risk_id
            - cvss_from
            - cvss_to
            - show_all
            - public_from
            - public_to
            - impact

    MetaAffectedSystems:
      allOf:
        - $ref: '#/components/schemas/Meta'
        - type: object
          properties:
            status_id:
              type: string
              description: Filer based on CVE status ID.
              example: '1,4'
              nullable: true
          required:
            - status_id

    MetaSystems:
      allOf:
        - $ref: '#/components/schemas/Meta'
        - type: object
          properties:
            opt_out:
              type: boolean
              description: Whether the filter to show opted out systems is active or not. If not set, defaults to hiding opted out systems.
              example: false
              nullable: true
          required:
            - opt_out

    MetaCves:
      allOf:
        - $ref: '#/components/schemas/Meta'
        - type: object
          properties:
            business_risk_id:
              type: string
              description: Filter based on business risk IDs.
              example: 1,3
              nullable: true
            cvss_from:
              type: number
              description: Filter based on cvss score, starting from the value.
              example: 4.6
              nullable: true
            cvss_to:
              type: number
              description: Filter based on cvss score, up to the value.
              example: 7.2
              nullable: true
            public_from:
              type: string
              description: Filter CVEs based on their published date, starting from the date.
              example: '2017-09-18T00:00:00+00:00'
              nullable: true
            public_to:
              type: string
              description: Filter CVEs based on their published date, up to the date.
              example: '2017-09-18T00:00:00+00:00'
              nullable: true
            impact:
              type: string
              description: Filter based on impact IDs.
              example: '5,7'
              nullable: true
            status_id:
              type: string
              description: Filer based on CVE status ID.
              example: '1,4'
              nullable: true
          required:
            - business_risk_id
            - cvss_from
            - cvss_to
            - public_from
            - public_to
            - impact
            - status_id

    MetaCvesSystems:
      allOf:
        - $ref: '#/components/schemas/MetaCves'
        - type: object
          properties:
            opt_out:
              type: boolean
              description: If given system was opted out.
              example: true
          required:
            - opt_out

    AffectedSystemsOut:
      type: object
      properties:
        data:
          oneOf:
            - type: string
              description: CSV export of the JSON.
            - type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    description: Host id.
                    example: INV-ID-0000-1234
                  type:
                    type: string
                    description: Type of the record.
                    example: system
                  attributes:
                    type: object
                    properties:
                      cve_status_id:
                        type: integer
                        description: Internal ID of the CVE status.
                        example: 4
                      display_name:
                        type: string
                        description: System's name.
                        example: system.example.com
                        nullable: true
                      inventory_id:
                        type: string
                        description: Host ID.
                        example: INV-ID00-0000-1234
                      last_evaluation:
                        type: string
                        description: Date of last evaluation.
                        example: '2018-09-22T16:00:00+00:00'
                        nullable: true
                      rule_id:
                        type: string
                        example: CVE_2017_14491_dnsmasq|CVE_2017_14491_ERROR
                        description: ID(s) of associated security rule(s).
                        nullable: true
                      rules_evaluation:
                        type: string
                        description: Date of last security rules evaluation.
                        example: '2018-09-22T16:00:00+00:00'
                        nullable: true
                      status_id:
                        type: integer
                        description: Internal ID of the vulnerability status.
                        example: 4
                      status_name:
                        type: string
                        description: Status of the vulnerability for the application's point of view.
                        example: Resolved
                      status_text:
                        type: string
                        description: Complementary text to the status.
                        example: Not relevant
                        nullable: true
                    required:
                      - cve_status_id
                      - display_name
                      - inventory_id
                      - last_evaluation
                      - rule_id
                      - rules_evaluation
                      - status_id
                      - status_name
                      - status_text
                required:
                  - id
                  - type
                  - attributes
        links:
          $ref: '#/components/schemas/Links'
        meta:
          $ref: '#/components/schemas/MetaAffectedSystems'
      required:
        - data
        - links
        - meta

    BusinessRiskListOut:
      type: object
      properties:
        data:
          type: array
          description: List of available business risk/business_risk_id pairs.
          items:
            type: object
            properties:
              id:
                type: integer
                description: Internal business_risk_id.
                example: 3
              name:
                type: string
                description: Represenation of internal business_risk_id.
                example: Low
            required:
              - id
              - name
        meta:
          type: object
          properties:
            total_items:
              type: integer
              description: Total number of available business risk/business_risk_id pairs.
              example: 1
          required:
            - total_items
      required:
        - data
        - meta

    CveDetailOut:
      type: object
      properties:
        data:
          type: object
          properties:
            id:
              type: string
              description: CVE id.
              example: CVE-2016-0800
            type:
              type: string
              description: Type of the record.
              example: cve
            attributes:
              type: object
              properties:
                business_risk:
                  type: string
                  description: Business risk of the vulnerability.
                  example: Low
                business_risk_id:
                  type: integer
                  description: Internal ID of the vulnerability business risk.
                  example: 1
                business_risk_text:
                  type: string
                  description: Complementary text to the business risk.
                  example: QA environment => Low business risk
                  nullable: true
                cvss2_metrics:
                  type: string
                  description: cvss2 metrics of the CVE.
                  example: 'AV:N/AC:M/Au:N/C:P/I:P/A:N'
                  nullable: true
                cvss2_score:
                  type: string
                  description: String representation of cvss2 score of the CVE.
                  example: '5.800'
                  nullable: true
                cvss3_metrics:
                  type: string
                  description: cvss3 metrics of the CVE.
                  example: 'AV:N/AC:M/Au:N/C:P/I:P/A:N'
                  nullable: true
                cvss3_score:
                  type: string
                  description: String representation of cvss3 score of the CVE.
                  example: '4.400'
                  nullable: true
                description:
                  type: string
                  description: Description of the CVE.
                  example: A padding oracle flaw was found in the Secure Sockets Layer version 2.0 (SSLv2) protocol. An attacker could...
                modified_date:
                  type: string
                  description: String representation of ISO-8601 formatted date of last modification of the CVE.
                  example: '2019-03-07T08:15:36+00:00'
                  nullable: true
                impact:
                  type: string
                  description: Red Hat security impact of the CVE.
                  example: Important
                public_date:
                  type: string
                  description: String representation of ISO-8601 formatted date of first public disclosure of the CVE.
                  example: '2016-03-01T00:00:00+00:00'
                  nullable: true
                redhat_url:
                  type: string
                  description: Additional resource about the CVE, provided by Red Hat.
                  example: https://access.redhat.com/security/cve/cve-2016-0800
                  nullable: true
                rules:
                  type: array
                  items:
                    $ref: '#/components/schemas/InsightsRule'
                secondary_url:
                  type: string
                  description: Additional resources about the CVE.
                  example: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0800
                  nullable: true
                status:
                  type: string
                  description: Status of the vulnerability.
                  example: Not Reviewed
                status_id:
                  type: integer
                  description: Internal ID of the vulnerability status.
                  example: 1
                status_text:
                  type: string
                  description: Complementary text to the status.
                  example: Not relevant
                  nullable: true
                synopsis:
                  type: string
                  description: Synopsis of the CVE.
                  example: CVE-2016-0800
                systems_status_detail:
                  type: object
                  description: Counts of systems with given status type.
                systems_status_divergent:
                  type: integer
                  description: How many systems-CVE pairs have different status than CVE-level.
                  example: 20
              required:
                - business_risk
                - business_risk_id
                - business_risk_text
                - cvss2_metrics
                - cvss2_score
                - cvss3_metrics
                - cvss3_score
                - description
                - impact
                - modified_date
                - public_date
                - redhat_url
                - rules
                - secondary_url
                - status
                - status_id
                - status_text
                - synopsis
                - systems_status_detail
                - systems_status_divergent
          required:
            - id
            - type
            - attributes

    CveRiskIn:
      type: object
      properties:
        cve:
          $ref: '#/components/schemas/CveOrList'
        business_risk_id:
          type: integer
          description: Business risk ID to be set, obtained by GET method.
          example: 3
        business_risk_text:
          type: string
          description: Complementary text to the business risk.
          example: Not relevant
          nullable: true
      required:
        - cve

    CveStatusIn:
      type: object
      properties:
        cve:
          $ref: '#/components/schemas/CveOrList'
        status_id:
          type: integer
          description: Status ID to be set, obtained by GET method.
          example: 3
        status_text:
          type: string
          description: Complementary text to the status.
          example: Not relevant
          nullable: true
      required:
        - cve

    CveOrList:
      oneOf:
        - type: string
          description: CVE name.
          example: CVE-2016-0800
        - type: array
          items:
            type: string
            example: CVE-2016-0800
          description: List of CVEs for a bulk change.
      example: CVE-2016-0800

    InventoryIdOrList:
      oneOf:
        - type: string
          description: Inventory ID.
          example: f35b1e1d-d231-43f2-8e4f-8f9cb01e3aa2
        - type: array
          items:
            type: string
            example: f35b1e1d-d231-43f2-8e4f-8f9cb01e3aa2
          description: List of inventory IDs for a bulk change.
      example: f35b1e1d-d231-43f2-8e4f-8f9cb01e3aa2

    OptOutIn:
      type: object
      properties:
        inventory_id:
          $ref: '#/components/schemas/InventoryIdOrList'
        opt_out:
          type: boolean
          description: Opt out setting to be set.
          example: true
      required:
        - inventory_id
        - opt_out

    BulkChangeOut:
      type: object
      properties:
        updated:
          type: array
          items:
            type: string
            example: f35b1e1d-d231-43f2-8e4f-8f9cb01e3aa2
          description: List of updated objects/updated object IDs.
      required:
        - updated

    StatusIn:
      type: object
      properties:
        inventory_id:
          $ref: '#/components/schemas/InventoryIdOrList'
        cve:
          $ref: '#/components/schemas/CveOrList'
        status_id:
          type: integer
          description: Status ID to be set, obtained by GET method. If not specified, global CVE status is set.
          example: 3
        status_text:
          type: string
          description: Complementary text to the status.
          example: Not relevant
          nullable: true
      required:
        - cve
  
    ExecutiveReport:
      type: object
      properties:
        system_count:
          type: integer
          description: Total number of systems managed by vulnerability application.
          example: 25641
        cves_total:
          type: integer
          description: Number of unique CVEs discovered on the managed systems.
          example: 1902
        cves_by_severity:
          type: object
          description: Number of CVEs discovered on the managed systems, divided into buckets based on their CVSSv3 score (CVSSv2 is used when CVSSv3 is not available).
          properties:
            0to3.9:
              type: object
              properties:
                count:
                  type: integer
                  description: Number of CVEs with CVSS score lower than 4.
                  example: 1902
                percentage: 
                  type: number
                  description: Percentage of CVEs with CVSS score lower than 4.
                  example: 60
              required:
                - count
                - percentage
            4to7.9:
              type: object
              properties:
                count:
                  type: integer
                  description: Number of CVEs with CVSS score higher or equal to 4 and lower then 8.
                  example: 400
                percentage: 
                  type: number
                  description: Percentage of CVEs with CVSS score higher or equal to 4 and lower then 8.
                  example: 15
              required:
                - count
                - percentage
            8to10:
              type: object
              properties:
                count:
                  type: integer
                  description: Number of CVEs with CVSS score higher or equal to 8.
                  example: 109
                percentage: 
                  type: number
                  description: Percentage of CVEs with CVSS score higher or equal to 8.
                  example: 2
              required:
                - count
                - percentage
          required:
            - 0to3.9
            - 4to7.9
            - 8to10
        recent_cves:
          type: object
          description: Number of recently published CVEs identified on managed systems
          properties:
            last7days:
              type: integer
              description: Number of CVEs identified on managed systems published in last 7 days.
              example: 14
            last30days:
              type: integer
              description: Number of CVEs identified on managed systems published in last 30 days.
              example: 62
            last90days:
              type: integer
              description: Number of CVEs identified on managed systems published in last 90 days.
              example: 156
          required:
            - last7days
            - last30days
            - last90days
        top_cves:
          type: array
          items:
            type: object
            properties:
              synopsis:
                type: string
                description: CVE synopsis
                example: CVE-2016-0800
              cvss2_score:
                type: string
                description: String representation of cvss2 score of the CVE.
                example: '5.800'
                nullable: true
              cvss3_score:
                type: string
                description: String representation of cvss3 score of the CVE.
                example: '4.400'
                nullable: true
              description:
                type: string
                description: Description of the CVE.
                example: A padding oracle flaw was found in the Secure Sockets Layer version 2.0 (SSLv2) protocol. An attacker could...
              systems_affected:
                type: integer
                description: Systems affected by the CVE.
                example: 1795
            required:
              - synopsis
              - cvss2_score
              - cvss3_score
              - description
              - systems_affected
      required:
        - system_count
        - cves_total
        - cves_by_severity
        - recent_cves
    
    StatusOut:
      type: object
      properties:
        updated:
          type: array
          items:
            type: object
            properties:
              inventory_id:
                type: string
                example: f35b1e1d-d231-43f2-8e4f-8f9cb01e3aa2
              cve:
                type: string
                example: CVE-2016-0800
            required:
              - inventory_id
              - cve
          description: List of updated objects/updated object IDs.
      required:
        - updated

    StatusListOut:
      type: object
      properties:
        data:
          type: array
          description: List of available status/status_id pairs.
          items:
            type: object
            properties:
              id:
                type: integer
                description: Internal status_id.
                example: 3
              name:
                type: string
                description: Represenation of internal status_id.
                example: Scheduled for Patch
            required:
              - id
              - name
        meta:
          type: object
          properties:
            total_items:
              type: integer
              description: Total number of available status/status_id pairs.
              example: 1
          required:
            - total_items
      required:
        - data
        - meta
  
    SystemCvesOut:
      type: object
      properties:
        data:
          oneOf:
            - type: string
              description: CSV export of the JSON.
            - type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    description: CVE id.
                    example: CVE-2016-0800
                  type:
                    type: string
                    description: Type of the record.
                    example: cve
                  attributes:
                    type: object
                    properties:
                      business_risk:
                        type: string
                        description: Business risk of the vulnerability.
                        example: Low
                      business_risk_id:
                        type: integer
                        description: Internal ID of the vulnerability business risk.
                        example: 1
                      business_risk_text:
                        type: string
                        description: Complementary text to the business risk.
                        example: QA environment => Low business risk
                        nullable: true
                      cve_status_id:
                        type: integer
                        description: Internal ID of the CVE status.
                        example: 4
                      cvss2_score:
                        type: string
                        description: String representation of cvss2 score of the CVE.
                        example: '5.800'
                        nullable: true
                      cvss3_score:
                        type: string
                        description: String representation of cvss3 score of the CVE.
                        example: '4.400'
                        nullable: true
                      description:
                        type: string
                        description: Description of the CVE.
                        example: A padding oracle flaw was found in the Secure Sockets Layer version 2.0 (SSLv2) protocol. An attacker could...
                      impact:
                        type: string
                        description: Red Hat security impact of the CVE.
                        example: Important
                      public_date:
                        type: string
                        description: String representation of ISO-8601 formatted date of first public disclosure of the CVE.
                        example: '2016-03-01T00:00:00+00:00'
                        nullable: true
                      rule:
                        type: object
                        nullable: true
                        properties:
                          rule_id:
                            type: string
                            example: CVE_2017_14491_dnsmasq|CVE_2017_14491_ERROR
                            description: ID(s) of associated security rule(s).
                          description:
                            type: string
                            description: Description of the rule.
                            example: CVE-2017-14491 dnsmasq code execution with listening processes
                            nullable: true
                          summary:
                            type: string
                            description: Summary of the rule.
                            example: A buffer overflow vulnerability was found in `Dnsmasq`, a popular lightweight DNS and DHCP server....
                            nullable: true
                          generic:
                            type: string
                            description: Generic information about the rule.
                            example: A vulnerability was discovered in Dnsmasq which allows an attacker to overflow a heap buffer and crash or take control of Dnsmasq...
                            nullable: true
                          reboot_required:
                            type: boolean
                            description: Indicator whter reboot is required to mitigate vulnerability.
                            example: false
                            nullable: true
                          playbook_count:
                            type: integer
                            description: Number of available Ansible playbooks for remediation/mitigation.
                            example: 1
                            nullable: true
                          change_risk:
                            type: integer
                            description: Indicates how likely remediation can change environment on the remediatied system.
                            example: 1
                            nullable: true
                          kbase_node_id:
                            type: integer
                            description: ID of associated Red Hat knowledgebase article.
                            example: 3199382
                            nullable: true
                        required:
                          - change_risk
                          - description
                          - generic
                          - kbase_node_id
                          - playbook_count
                          - reboot_required
                          - rule_id
                          - summary
                      status:
                        type: string
                        description: Status of the vulnerability for the application's point of view.
                        example: Resolved
                      status_id:
                        type: integer
                        description: Internal ID of the vulnerability status.
                        example: 4
                      status_text:
                        type: string
                        description: Complementary text to the status.
                        example: Not relevant
                        nullable: true
                      synopsis:
                        type: string
                        description: Synopsis of the CVE.
                        example: CVE-2016-0800
                    required:
                      - business_risk
                      - business_risk_id
                      - business_risk_text
                      - cve_status_id
                      - cvss2_score
                      - cvss3_score
                      - description
                      - impact
                      - public_date
                      - rule
                      - status
                      - status_id
                      - status_text
                      - synopsis
                required:
                  - id
                  - type
                  - attributes
        links:
          $ref: '#/components/schemas/Links'
        meta:
          $ref: '#/components/schemas/MetaCves'
      required:
        - data
        - links
        - meta

    SystemDetailsOut:
      type: object
      properties:
        data:
          type: object
          properties:
            last_evaluation:
              type: string
              description: Date of last evaluation.
              example: '2018-09-22T16:00:00+00:00'
              nullable: true
            rules_evaluation:
              type: string
              description: Date of last security rules evaluation.
              example: '2018-09-22T16:00:00+00:00'
              nullable: true
            opt_out:
              type: boolean
              description: System opt out status.
              example: true
            last_upload:
              type: string
              description: Date of the latest upload of archive.
              example: '2018-09-22T16:00:00+00:00'
              nullable: true
            stale:
              type: boolean
              description: System stale status.
              example: true
          required:
            - last_evaluation
            - rules_evaluation
            - opt_out
            - last_upload
      required:
        - data

    SystemListOut:
      type: object
      properties:
        data:
          oneOf:
            - type: string
              description: CSV export of the JSON.
            - type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    description: Host ID.
                    example: INV-ID00-0000-1234
                  type:
                    type: string
                    description: Type of the record.
                    example: system
                  attributes:
                    type: object
                    properties:
                      cve_count:
                        type: integer
                        description: Number of CVE exposures for the system.
                        example: 7
                        nullable: true
                      display_name:
                        type: string
                        description: System's name,
                        example: system.example.com
                        nullable: true
                      inventory_id:
                        type: string
                        description: Host ID.
                        example: INV-ID00-0000-1234
                      last_evaluation:
                        type: string
                        description: Date of last evaluation.
                        example: '2018-09-22T16:00:00+00:00'
                        nullable: true
                      rules_evaluation:
                        type: string
                        description: Date of last security rules evaluation.
                        example: '2018-09-22T16:00:00+00:00'
                        nullable: true
                      opt_out:
                        type: boolean
                        description: Opt out status of the system.
                        example: false
                      last_upload:
                        type: string
                        description: Date of the latest upload of archive.
                        example: '2018-09-22T16:00:00+00:00'
                        nullable: true
                      stale_timestamp:
                        type: string
                        description: Date when stale system becomes stale.
                        example: '2018-09-22T16:00:00+00:00'
                        nullable: true
                      stale_warning_timestamp:
                        type: string
                        description: Date when stale system becomes hidden in the application.
                        example: '2018-09-22T16:00:00+00:00'
                        nullable: true
                    required:
                      - cve_count
                      - display_name
                      - inventory_id
                      - last_evaluation
                      - rules_evaluation
                      - opt_out
                      - last_upload
                      - stale_timestamp
                      - stale_warning_timestamp
                required:
                  - id
                  - type
                  - attributes
        links:
          $ref: '#/components/schemas/Links'
        meta:
          $ref: '#/components/schemas/MetaSystems'
      required:
        - data
        - links
        - meta

    VulnerabilitiesOut:
      type: object
      properties:
        data:
          oneOf:
            - type: string
              description: CSV export of the JSON.
            - type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                    description: CVE id.
                    example: CVE-2016-0800
                  type:
                    type: string
                    description: Type of the record.
                    example: cve
                  attributes:
                    type: object
                    properties:
                      business_risk:
                        type: string
                        description: Business risk of the vulnerability.
                        example: Low
                      business_risk_id:
                        type: integer
                        description: Internal ID of the vulnerability business risk.
                        example: 1
                      business_risk_text:
                        type: string
                        description: Complementary text to the business risk.
                        example: QA environment => Low business risk
                        nullable: true
                      cvss2_score:
                        type: string
                        description: String representation of cvss2 score of the CVE.
                        example: '5.800'
                        nullable: true
                      cvss3_score:
                        type: string
                        description: String representation of cvss3 score of the CVE.
                        example: '4.400'
                        nullable: true
                      description:
                        type: string
                        description: Description of the CVE.
                        example: A padding oracle flaw was found in the Secure Sockets Layer version 2.0 (SSLv2) protocol. An attacker could...
                      impact:
                        type: string
                        description: Red Hat security impact of the CVE.
                        example: Important
                      public_date:
                        type: string
                        description: String representation of ISO-8601 formatted date of first public disclosure of the CVE.
                        example: '2016-03-01T00:00:00+00:00'
                        nullable: true
                      rules:
                        type: array
                        items:
                          $ref: '#/components/schemas/InsightsRule'
                      status:
                        type: string
                        description: Status of the vulnerability.
                        example: Not Reviewed
                      status_id:
                        type: integer
                        description: Internal ID of the vulnerability status.
                        example: 1
                      status_text:
                        type: string
                        description: Complementary text to the status.
                        example: Not Relevant
                        nullable: true
                      synopsis:
                        type: string
                        description: Synopsis of the CVE.
                        example: CVE-2016-0800
                      systems_affected:
                        type: integer
                        description: Number of systems affected by the CVE.
                        example: 7
                      systems_status_divergent:
                        type: integer
                        description: How many systems-CVE pairs have different status than CVE-level.
                        example: 20
                    required:
                      - business_risk
                      - business_risk_id
                      - business_risk_text
                      - cvss2_score
                      - cvss3_score
                      - description
                      - impact
                      - public_date
                      - rules
                      - status
                      - status_id
                      - status_text
                      - synopsis
                      - systems_affected
                      - systems_status_divergent
                required:
                  - id
                  - type
                  - attributes
        links:
          $ref: '#/components/schemas/Links'
        meta:
          $ref: '#/components/schemas/MetaVulnerabilitiesOut'
      required:
        - data
        - links
        - meta

    VersionOut:
      type: object
      properties:
        application_version:
          type: string
          description: Version of application.
          example: 0.1.2
        database_version:
          oneOf:
            - type: string
            - type: number
          description: Version of database schema.
          example: 1
      required:
        - application_version
        - database_version

    InsightsRule:
      type: object
      properties:
        rule_id:
          type: string
          example: CVE_2017_14491_dnsmasq|CVE_2017_14491_ERROR
          description: ID(s) of associated security rule(s).
        description:
          type: string
          description: Description of the rule.
          example: CVE-2017-14491 dnsmasq code execution with listening processes
          nullable: true
        summary:
          type: string
          description: Summary of the rule.
          example: A buffer overflow vulnerability was found in `Dnsmasq`, a popular lightweight DNS and DHCP server....
          nullable: true
        generic:
          type: string
          description: Generic information about the rule.
          example: A vulnerability was discovered in Dnsmasq which allows an attacker to overflow a heap buffer and crash or take control of Dnsmasq...
          nullable: true
        reboot_required:
          type: boolean
          description: Indicator whter reboot is required to mitigate vulnerability.
          example: false
          nullable: true
        playbook_count:
          type: integer
          description: Number of available Ansible playbooks for remediation/mitigation.
          example: 1
          nullable: true
        change_risk:
          type: integer
          description: Indicates how likely remediation can change environment on the remediatied system.
          example: 1
          nullable: true
        kbase_node_id:
          type: integer
          description: ID of associated Red Hat knowledgebase article.
          example: 3199382
          nullable: true
        associated_cves:
          type: array
          items:
            type: string
            example: CVE-2016-0800
          description: List of CVEs associated with the rule.
      required:
        - associated_cves
        - change_risk
        - description
        - generic
        - kbase_node_id
        - playbook_count
        - reboot_required
        - rule_id
        - summary