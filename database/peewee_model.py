"""
Database to peewee mappings
"""

from peewee import Model, TextField, DateTimeField, DecimalField, ForeignKeyField
from database.peewee_handler import PeeweeHandler


class UnknownField:
    """UnknownField"""
    def __init__(self, *_, **__):
        pass


class BaseModel(Model):
    """Base class for tables"""
    class Meta:
        """Base class for table metadata"""
        database = PeeweeHandler.get_db()


class SystemPlatform(BaseModel):
    """system_platform table"""
    platform_id = TextField(null=False, unique=True)
    rh_account = TextField(null=False)
    display_name = TextField(null=False)
    first_reported = DateTimeField(null=False)
    s3_url = TextField(null=True)
    vmaas_json = TextField(null=True)
    json_checksum = TextField(null=True)
    last_updated = DateTimeField(null=False)
    unchanged_since = DateTimeField(null=False)

    class Meta:
        """system_platform table metadata"""
        db_table = "system_platform"
        primary_key = False


class VulnerabilitySource(BaseModel):
    """vulnerability_source table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """vulnerability_source table metadata"""
        db_table = "vulnerability_source"

class CveImpact(BaseModel):
    """cve_impact table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """cve_impact table metadata"""
        db_table = "cve_impact"

class CveMetadata(BaseModel):
    """cve_metadata table"""
    cve = TextField(primary_key=True)
    cvss3_score = DecimalField(index=True, null=True)
    cvss3_metrics = TextField(null=True)
    description = TextField(null=False)
    impact_id = ForeignKeyField(db_column="impact_id", rel_model=CveImpact, to_field="id") # pylint: disable=no-value-for-parameter
    public_date = DateTimeField(null=False)
    modified_date = DateTimeField(null=False)
    cvss2_score = DecimalField(index=True, null=True)
    cvss2_metrics = TextField(null=True)

    class Meta:
        """cve_metadata table metadata"""
        db_table = 'cve_metadata'


class SystemVulnerabilities(BaseModel):
    """system_vulnerabilities table"""
    platform_id = ForeignKeyField(db_column="platform_id", rel_model=SystemPlatform, to_field="platform_id") # pylint: disable=no-value-for-parameter
    cve = ForeignKeyField(db_column="cve", rel_model=CveMetadata, to_field="cve") # pylint: disable=no-value-for-parameter
    vulnerability_source = ForeignKeyField(db_column="vulnerability_source", rel_model=VulnerabilitySource, to_field="id") # pylint: disable=no-value-for-parameter, line-too-long
    first_reported = DateTimeField(null=False)
    when_mitigated = DateTimeField(null=True)

    class Meta:
        """system_vulnerabilities table metadata"""
        db_table = "system_vulnerabilities"
        primary_key = False


class ProdsecErrorKey(BaseModel):
    """prodsec_error_key table"""
    name = TextField(null=False, unique=True)

    class Meta:
        """prodsec_error_key table metadata"""
        db_table = 'prodsec_error_key'


class SystemProdsecErrorKey(BaseModel):
    """system_prodsec_error_key table"""
    platform_id = ForeignKeyField(db_column="platform_id", rel_model=SystemPlatform, to_field="platform_id") # pylint: disable=no-value-for-parameter
    error_key_id = ForeignKeyField(db_column="error_key_id", rel_model=ProdsecErrorKey, to_field="id") # pylint: disable=no-value-for-parameter
    first_reported = DateTimeField(null=False)
    when_mitigated = DateTimeField(null=True)

    class Meta:
        """system_prodsec_error_key table metadata"""
        db_table = 'system_prodsec_error_key'
        primary_key = False
