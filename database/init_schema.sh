#!/usr/bin/bash

if $PG_INITIALIZED ; then
    # create users, set privileges
    psql -d ${POSTGRESQL_DATABASE} <<EOF
    CREATE USER ${POSTGRESQL_WRITER_USER} WITH PASSWORD '${POSTGRESQL_WRITER_PASSWORD}';
    CREATE USER ${POSTGRESQL_READER_USER} WITH PASSWORD '${POSTGRESQL_READER_PASSWORD}';
    GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO ${POSTGRESQL_WRITER_USER};
    GRANT USAGE, SELECT, UPDATE ON ALL SEQUENCES IN SCHEMA public TO ${POSTGRESQL_WRITER_USER};
    GRANT SELECT ON ALL TABLES IN SCHEMA public TO ${POSTGRESQL_READER_USER};
EOF

    cat ${CONTAINER_SCRIPTS_PATH}/start/schema*.sql | psql -U ${POSTGRESQL_USER} -d ${POSTGRESQL_DATABASE}
else
    echo "Schema initialization skipped."
fi
