#!/usr/bin/bash

if $PG_INITIALIZED ; then
    psql -d ${POSTGRESQL_DATABASE} -f ${CONTAINER_SCRIPTS_PATH}/start/ve_db_user_create_postgresql.sql
    psql -U ${POSTGRESQL_USER} -d ${POSTGRESQL_DATABASE} -f ${CONTAINER_SCRIPTS_PATH}/start/ve_db_postgresql.sql

    # temp section to load dev data
    if [ -f ${CONTAINER_SCRIPTS_PATH}/start/ve_db_dev_data.sql ] ; then
        psql -U ${POSTGRESQL_USER} -d ${POSTGRESQL_DATABASE} -f ${CONTAINER_SCRIPTS_PATH}/start/ve_db_dev_data.sql
    fi

    psql -c "ALTER USER ve_db_user_manager WITH PASSWORD '${VE_DB_USER_MANAGER_PASSWORD}'" -d ${POSTGRESQL_DATABASE}
    psql -c "ALTER USER ve_db_user_evaluator WITH PASSWORD '${VE_DB_USER_EVALUATOR_PASSWORD}'" -d ${POSTGRESQL_DATABASE}
    psql -c "ALTER USER ve_db_user_listener WITH PASSWORD '${VE_DB_USER_LISTENER_PASSWORD}'" -d ${POSTGRESQL_DATABASE}
else
    echo "Schema initialization skipped."
fi
