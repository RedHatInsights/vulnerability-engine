FROM docker.io/centos/postgresql-12-centos8

# Install pg_repack
USER root
ADD /database/RPM-GPG-KEY-CENTOS /etc/pki/rpm-gpg/
ARG PG_REPACK_RPM=pg_repack-1.4.6-3.module_el8.5.0+842+bf20b04a.x86_64.rpm
RUN curl http://mirror.centos.org/centos/8-stream/AppStream/x86_64/os/Packages/${PG_REPACK_RPM} -o /tmp/${PG_REPACK_RPM} && \
    rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CENTOS && \
    rpm -K /tmp/${PG_REPACK_RPM} && \
    rpm -ivh /tmp/${PG_REPACK_RPM}

USER postgres

ENV POSTGRESQL_USER 've_db_admin'
ENV POSTGRESQL_PASSWORD 've_db_admin_pwd'
ENV POSTGRESQL_DATABASE 'vulnerability'
ENV POSTGRESQL_MAX_CONNECTIONS '500'
ENV VE_DB_USER_MANAGER_PASSWORD 've_db_user_manager_pwd'
ENV VE_DB_USER_EVALUATOR_PASSWORD 've_db_user_evaluator_pwd'
ENV VE_DB_USER_LISTENER_PASSWORD 've_db_user_listener_pwd'
ENV VE_DB_USER_VMAAS_SYNC_PASSWORD 've_db_user_vmaas_sync_pwd'
ENV VE_DB_USER_TASKOMATIC_PASSWORD 've_db_user_taskomatic_pwd'
ENV VE_DB_USER_ADVISOR_LISTENER_PASSWORD 've_db_user_advisor_listener_pwd'
ENV VE_DB_USER_NOTIFICATOR_PASSWORD 've_db_user_notificator_pwd'
ENV CYNDI_DB_ADMIN_PASSWORD 'cyndi_db_admin_pwd'

ADD database/schema/ve_db_postgresql.sql ${CONTAINER_SCRIPTS_PATH}/start/
ADD database/schema/ve_db_user_create_postgresql.sql ${CONTAINER_SCRIPTS_PATH}/start/
ADD database/schema/init_schema.sh ${CONTAINER_SCRIPTS_PATH}/start/
ADD database/schema/ve_db_dev_cyndi.sql ${CONTAINER_SCRIPTS_PATH}/start/
