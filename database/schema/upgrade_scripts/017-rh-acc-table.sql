-- rh_account table
CREATE TABLE IF NOT EXISTS rh_account (
  id SERIAL,
  name TEXT NOT NULL UNIQUE, CHECK (NOT empty(name)),
  PRIMARY KEY (id)
) TABLESPACE pg_default;

GRANT SELECT, INSERT, UPDATE, DELETE ON rh_account TO ve_db_user_listener;
GRANT SELECT, DELETE ON rh_account TO ve_db_user_manager;
GRANT SELECT ON rh_account TO ve_db_user_vmaas_sync;
GRANT SELECT ON rh_account TO ve_db_user_evaluator;

GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO ve_db_user_evaluator;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO ve_db_user_listener;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO ve_db_user_vmaas_sync;

-- fill rh_account table
INSERT INTO rh_account(name) SELECT rh_account FROM system_platform UNION SELECT rh_account FROM cve_affected_systems_cache;
