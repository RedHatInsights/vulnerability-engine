-- business_risk table
CREATE TABLE IF NOT EXISTS business_risk (
  id INT NOT NULL,
  name VARCHAR NOT NULL UNIQUE,
  CHECK (NOT empty(name)),
  PRIMARY KEY (id)
) TABLESPACE pg_default;

INSERT INTO business_risk (id, name) VALUES
  (0, 'Not Defined'), (1, 'Low'), (2, 'Medium'), (3, 'High');

-- cve_preferences
CREATE TABLE IF NOT EXISTS cve_account_data (
  cve_id INT NOT NULL,
  rh_account_id INT NOT NULL,
  business_risk_id INT NOT NULL DEFAULT 0,
  business_risk_text TEXT,
  CONSTRAINT cve_id
    FOREIGN KEY (cve_id)
    REFERENCES cve_metadata (id),
  CONSTRAINT rh_account_id
    FOREIGN KEY (rh_account_id)
    REFERENCES rh_account (id),
  CONSTRAINT business_risk_id
    FOREIGN KEY (business_risk_id)
    REFERENCES business_risk (id),
  UNIQUE (cve_id, rh_account_id)
) TABLESPACE pg_default;

GRANT SELECT, INSERT, UPDATE, DELETE ON cve_account_data TO ve_db_user_manager;

GRANT SELECT ON ALL TABLES IN SCHEMA public TO ve_db_user_evaluator;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO ve_db_user_listener;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO ve_db_user_manager;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO ve_db_user_vmaas_sync;
