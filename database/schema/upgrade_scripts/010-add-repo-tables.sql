-- repo
CREATE TABLE repo (
  id SERIAL,
  name TEXT NOT NULL UNIQUE, CHECK (NOT empty(name)),
  PRIMARY KEY (id)
) TABLESPACE pg_default;

GRANT SELECT, INSERT, UPDATE, DELETE ON repo TO ve_db_user_listener;

-- system_repo
CREATE TABLE system_repo (
  inventory_id TEXT NOT NULL, CHECK (NOT empty(inventory_id)),
  repo_id INT NOT NULL,
  UNIQUE (inventory_id, repo_id),
  CONSTRAINT inventory_id
    FOREIGN KEY (inventory_id)
    REFERENCES system_platform (inventory_id),
  CONSTRAINT repo_id
    FOREIGN KEY (repo_id)
    REFERENCES repo (id)
) TABLESPACE pg_default;

CREATE INDEX ON system_repo(inventory_id);
CREATE INDEX ON system_repo(repo_id);

GRANT SELECT, INSERT, UPDATE, DELETE ON system_repo TO ve_db_user_listener;

-- user for evaluator component
GRANT SELECT ON repo TO ve_db_user_evaluator;
GRANT SELECT ON system_repo TO ve_db_user_evaluator;
GRANT USAGE, SELECT ON repo_id_seq TO ve_db_user_evaluator;

-- user for listener component
GRANT SELECT ON repo TO ve_db_user_listener;
GRANT SELECT ON system_repo TO ve_db_user_listener;
GRANT USAGE, SELECT ON repo_id_seq TO ve_db_user_listener;

-- user for UI manager component
GRANT SELECT ON repo TO ve_db_user_manager;
GRANT SELECT ON system_repo TO ve_db_user_manager;

GRANT SELECT ON repo TO ve_db_user_vmaas_sync;
GRANT SELECT ON system_repo TO ve_db_user_vmaas_sync;
