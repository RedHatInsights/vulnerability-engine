#!/usr/bin/bash

TESTDIR=$1
if [ ! -d "$TESTDIR" ] ; then
    echo "usage: $(basename $0) <testdir>" >&2
    exit 1
fi

# for listener copy database handler
if [ "$TESTDIR" == "listener" ] ; then
    mkdir listener/database
    cp database/database_handler.py listener/database
fi

# for evaluator copy database handler
if [ "$TESTDIR" == "evaluator" ] ; then
    mkdir evaluator/database
    cp database/database_handler.py evaluator/database
    cp listener/mqueue.py evaluator/mqueue.py
fi

# for manager copy also related database stuff there
if [ "$TESTDIR" == "manager" ] ; then
    mkdir manager/database
    cp database/peewee_handler.py manager/database
    cp database/peewee_model.py manager/database
fi

(
# Go to script's directory
cd "$TESTDIR"

rc=0

# Run pylint
find . -iname '*.py' | xargs pylint --rcfile=../pylintrc
rc=$(($rc+$?))

exit $rc
)

