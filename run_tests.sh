#!/bin/bash

rc=0

# Check for python deps updates.
CYAN='\033[0;36m'
NO_COLOR='\033[0m'
echo -e "${CYAN}Dependency updates checking...${NO_COLOR}"
pip freeze > /tmp/req.txt
pur -r /tmp/req.txt --verify True -o /dev/null | grep "Updated" | sed -e "s/Updated/You can update:/g"
echo -e "${CYAN}------------------------------${NO_COLOR}"

# Make sure there is __init__.py in each dir containing python scripts
find . -name '*.py' | xargs dirname | sort | uniq | xargs -I {} bash -c "test -f {}/__init__.py || ( echo {} directory does not have __init__.py! && false )"
rc=$(($rc+$?))

# Run unit tests
echo "Running unit tests:"
pytest -vvv -s --cov-report term --cov --color=yes --durations=1
rc=$(($rc+$?))

exit $rc
